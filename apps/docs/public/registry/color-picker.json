{
  "$schema": "https://ui.shadcn.com/schema/registry.json",
  "homepage": "https://www.kibo-ui.com/color-picker",
  "name": "color-picker",
  "type": "registry:ui",
  "author": "Hayden Bleasel <hello@haydenbleasel.com>",
  "registryDependencies": [
    "button",
    "input",
    "select"
  ],
  "dependencies": [
    "@radix-ui/react-slider",
    "@radix-ui/react-use-controllable-state",
    "color",
    "lucide-react"
  ],
  "devDependencies": [
    "@types/color"
  ],
  "files": [
    {
      "type": "registry:ui",
      "path": "index.tsx",
      "content": "import { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { cn } from '@/lib/utils';\nimport { Range, Root, Thumb, Track } from '@radix-ui/react-slider';\nimport { useControllableState } from '@radix-ui/react-use-controllable-state';\nimport Color from 'color';\nimport { PipetteIcon } from 'lucide-react';\nimport {\n  type ComponentProps,\n  type HTMLAttributes,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { createContext, useContext } from 'react';\n\ntype ColorPickerValue = {\n  hue: number;\n  saturation: number;\n  lightness: number;\n  alpha: number;\n};\n\ninterface ColorPickerContextValue {\n  value: ColorPickerValue;\n  onValueChange: (value: ColorPickerValue) => void;\n  mode: string;\n  setMode: (mode: string) => void;\n}\n\nconst ColorPickerContext = createContext<ColorPickerContextValue | undefined>(\n  undefined\n);\n\nexport const useColorPicker = () => {\n  const context = useContext(ColorPickerContext);\n\n  if (!context) {\n    throw new Error('useColorPicker must be used within a ColorPickerProvider');\n  }\n\n  return context;\n};\n\nexport type ColorPickerProps = HTMLAttributes<HTMLDivElement> & {\n  value?: Parameters<typeof Color>[0];\n  defaultValue?: Parameters<typeof Color>[0];\n  onChange?: (value: Parameters<typeof Color.rgb>[0]) => void;\n};\n\nconst parseColor = (value: Parameters<typeof Color>[0]) => {\n  try {\n    return {\n      hue: Color(value).hue(),\n      saturation: Color(value).saturationl(),\n      lightness: Color(value).lightness(),\n      alpha: Color(value).alpha(),\n    };\n  } catch (error) {\n    console.error('Invalid color:', error);\n    return undefined;\n  }\n};\n\nexport const ColorPicker = ({\n  value: controlledValue,\n  defaultValue,\n  onChange,\n  className,\n  ...props\n}: ColorPickerProps) => {\n  const [value, onValueChange] = useControllableState<ColorPickerValue>({\n    defaultProp: parseColor(defaultValue),\n    prop: parseColor(controlledValue),\n    onChange: onChange,\n  });\n\n  const [mode, setMode] = useState('hex');\n\n  // Notify parent of changes\n  useEffect(() => {\n    if (onChange && value) {\n      const color = Color.hsl(\n        value.hue,\n        value.saturation,\n        value.lightness\n      ).alpha(value.alpha / 100);\n      const rgba = color.rgb().array();\n\n      onChange([rgba[0], rgba[1], rgba[2], value.alpha / 100]);\n    }\n  }, [value, onChange]);\n\n  return (\n    <ColorPickerContext.Provider\n      value={{\n        value: value ?? {\n          hue: 0,\n          saturation: 100,\n          lightness: 50,\n          alpha: 100,\n        },\n        onValueChange,\n        mode,\n        setMode,\n      }}\n    >\n      <div className={cn('grid w-full gap-4', className)} {...props} />\n    </ColorPickerContext.Provider>\n  );\n};\n\nexport type ColorPickerSelectionProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ColorPickerSelection = ({\n  className,\n  ...props\n}: ColorPickerSelectionProps) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const { value, onValueChange } = useColorPicker();\n\n  const handlePointerMove = useCallback(\n    (event: PointerEvent) => {\n      if (!isDragging || !containerRef.current) {\n        return;\n      }\n\n      const rect = containerRef.current.getBoundingClientRect();\n      const x = Math.max(\n        0,\n        Math.min(1, (event.clientX - rect.left) / rect.width)\n      );\n      const y = Math.max(\n        0,\n        Math.min(1, (event.clientY - rect.top) / rect.height)\n      );\n\n      setPosition({ x, y });\n      onValueChange({\n        ...value,\n        saturation: (1 - y) * 100,\n      });\n    },\n    [isDragging, value, onValueChange]\n  );\n\n  useEffect(() => {\n    if (isDragging) {\n      window.addEventListener('pointermove', handlePointerMove);\n      window.addEventListener('pointerup', () => setIsDragging(false));\n    }\n    return () => {\n      window.removeEventListener('pointermove', handlePointerMove);\n      window.removeEventListener('pointerup', () => setIsDragging(false));\n    };\n  }, [isDragging, handlePointerMove]);\n\n  return (\n    <div\n      ref={containerRef}\n      className={cn(\n        'relative aspect-[4/3] w-full cursor-crosshair rounded',\n        className\n      )}\n      style={{\n        background: `linear-gradient(0deg,rgb(0,0,0),transparent),linear-gradient(90deg,rgb(255,255,255),hsl(${value.hue},100%,50%))`,\n      }}\n      onPointerDown={(e) => {\n        e.preventDefault();\n        setIsDragging(true);\n        handlePointerMove(e.nativeEvent);\n      }}\n      {...props}\n    >\n      <div\n        className=\"-translate-x-1/2 -translate-y-1/2 pointer-events-none absolute h-4 w-4 rounded-full border-2 border-white\"\n        style={{\n          left: `${position.x * 100}%`,\n          top: `${position.y * 100}%`,\n          boxShadow: '0 0 0 1px rgba(0,0,0,0.5)',\n        }}\n      />\n    </div>\n  );\n};\n\nexport type ColorPickerHueProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ColorPickerHue = ({\n  className,\n  ...props\n}: ColorPickerHueProps) => {\n  const { value, onValueChange } = useColorPicker();\n\n  return (\n    <Root\n      value={[value.hue]}\n      max={360}\n      step={1}\n      className={cn('relative flex h-4 w-full touch-none', className)}\n      onValueChange={([hue]) => onValueChange({ ...value, hue })}\n      {...props}\n    >\n      <Track className=\"relative my-0.5 h-3 w-full grow rounded-full bg-[linear-gradient(90deg,#FF0000,#FFFF00,#00FF00,#00FFFF,#0000FF,#FF00FF,#FF0000)]\">\n        <Range className=\"absolute h-full\" />\n      </Track>\n      <Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n    </Root>\n  );\n};\n\nexport type ColorPickerAlphaProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ColorPickerAlpha = ({\n  className,\n  ...props\n}: ColorPickerAlphaProps) => {\n  const { value, onValueChange } = useColorPicker();\n\n  return (\n    <Root\n      value={[value.alpha]}\n      max={100}\n      step={1}\n      className={cn('relative flex h-4 w-full touch-none', className)}\n      onValueChange={([alpha]) => onValueChange({ ...value, alpha })}\n      {...props}\n    >\n      <Track\n        className=\"relative my-0.5 h-3 w-full grow rounded-full\"\n        style={{\n          background:\n            'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==\") left center',\n        }}\n      >\n        <div className=\"absolute inset-0 rounded-full bg-gradient-to-r from-transparent to-primary/50\" />\n        <Range className=\"absolute h-full rounded-full bg-transparent\" />\n      </Track>\n      <Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n    </Root>\n  );\n};\n\nexport type ColorPickerEyeDropperProps = ComponentProps<typeof Button>;\n\nexport const ColorPickerEyeDropper = ({\n  className,\n  ...props\n}: ColorPickerEyeDropperProps) => {\n  const { value, onValueChange } = useColorPicker();\n\n  const handleEyeDropper = async () => {\n    try {\n      // @ts-ignore - EyeDropper API is experimental\n      const eyeDropper = new EyeDropper();\n      const result = await eyeDropper.open();\n      const color = Color(result.sRGBHex);\n      const [h, s, l] = color.hsl().array();\n\n      onValueChange({\n        ...value,\n        hue: h,\n        saturation: s,\n        lightness: l,\n        alpha: 100,\n      });\n    } catch (error) {\n      console.error('EyeDropper failed:', error);\n    }\n  };\n\n  return (\n    <Button\n      variant=\"outline\"\n      size=\"icon\"\n      onClick={handleEyeDropper}\n      className={cn('shrink-0 text-muted-foreground', className)}\n      {...props}\n    >\n      <PipetteIcon size={16} />\n    </Button>\n  );\n};\n\nexport type ColorPickerOutputProps = ComponentProps<typeof SelectTrigger>;\n\nconst formats = ['hex', 'rgb', 'css', 'hsl'];\n\nexport const ColorPickerOutput = ({\n  className,\n  ...props\n}: ColorPickerOutputProps) => {\n  const { mode, setMode } = useColorPicker();\n\n  return (\n    <Select value={mode} onValueChange={setMode}>\n      <SelectTrigger className=\"h-8 w-[4.5rem] shrink-0 text-xs\" {...props}>\n        <SelectValue placeholder=\"Mode\" />\n      </SelectTrigger>\n      <SelectContent>\n        {formats.map((format) => (\n          <SelectItem key={format} value={format} className=\"text-xs\">\n            {format.toUpperCase()}\n          </SelectItem>\n        ))}\n      </SelectContent>\n    </Select>\n  );\n};\n\ntype PercentageInputProps = ComponentProps<typeof Input>;\n\nconst PercentageInput = ({ className, ...props }: PercentageInputProps) => {\n  return (\n    <div className=\"relative\">\n      <Input\n        type=\"text\"\n        {...props}\n        className={cn(\n          'h-8 w-[3.25rem] rounded-l-none bg-secondary px-2 text-xs shadow-none',\n          className\n        )}\n      />\n      <span className=\"-translate-y-1/2 absolute top-1/2 right-2 text-muted-foreground text-xs\">\n        %\n      </span>\n    </div>\n  );\n};\n\nexport type ColorPickerFormatProps = HTMLAttributes<HTMLDivElement>;\n\nexport const ColorPickerFormat = ({\n  className,\n  ...props\n}: ColorPickerFormatProps) => {\n  const { value, mode } = useColorPicker();\n  const color = Color.hsl(\n    value.hue,\n    value.saturation,\n    value.lightness,\n    value.alpha / 100\n  );\n\n  if (mode === 'hex') {\n    const hex = color.hex();\n\n    return (\n      <div\n        className={cn(\n          '-space-x-px relative flex items-center shadow-sm',\n          className\n        )}\n        {...props}\n      >\n        <span className=\"-translate-y-1/2 absolute top-1/2 left-2 text-xs\">\n          #\n        </span>\n        <Input\n          type=\"text\"\n          value={hex}\n          className=\"h-8 rounded-r-none bg-secondary px-2 text-xs shadow-none\"\n        />\n        <PercentageInput value={value.alpha} />\n      </div>\n    );\n  }\n\n  if (mode === 'rgb') {\n    const rgb = color\n      .rgb()\n      .array()\n      .map((value) => Math.round(value));\n\n    return (\n      <div\n        className={cn('-space-x-px flex items-center shadow-sm', className)}\n        {...props}\n      >\n        {rgb.map((value, index) => (\n          <Input\n            key={index}\n            type=\"text\"\n            value={value}\n            readOnly\n            className={cn(\n              'h-8 rounded-r-none bg-secondary px-2 text-xs shadow-none',\n              index && 'rounded-l-none',\n              className\n            )}\n          />\n        ))}\n        <PercentageInput value={value.alpha} />\n      </div>\n    );\n  }\n\n  if (mode === 'css') {\n    const rgb = color\n      .rgb()\n      .array()\n      .map((value) => Math.round(value));\n\n    return (\n      <div className={cn('w-full shadow-sm', className)} {...props}>\n        <Input\n          type=\"text\"\n          className=\"h-8 w-full bg-secondary px-2 text-xs shadow-none\"\n          value={`rgba(${rgb.join(', ')}, ${value.alpha}%)`}\n          readOnly\n          {...props}\n        />\n      </div>\n    );\n  }\n\n  if (mode === 'hsl') {\n    const hsl = color\n      .hsl()\n      .array()\n      .map((value) => Math.round(value));\n\n    return (\n      <div\n        className={cn('-space-x-px flex items-center shadow-sm', className)}\n        {...props}\n      >\n        {hsl.map((value, index) => (\n          <Input\n            key={index}\n            type=\"text\"\n            value={value}\n            readOnly\n            className={cn(\n              'h-8 rounded-r-none bg-secondary px-2 text-xs shadow-none',\n              index && 'rounded-l-none',\n              className\n            )}\n          />\n        ))}\n        <PercentageInput value={value.alpha} />\n      </div>\n    );\n  }\n\n  return null;\n};\n",
      "target": "components/ui/kibo-ui/color-picker.tsx"
    }
  ]
}